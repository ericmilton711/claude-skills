# Network Configuration Summary - 2026-01-06

## Overview
Completed WireGuard VPN installation and configuration on USG 3P, along with Pi-hole DNS blocking for YouTube.

---

## ✓ Completed Tasks

### 1. Pi-hole YouTube Blocking (2026-01-05)
**Status:** Fully operational

- Pi-hole configured with YouTube domain blocklist
- USG DHCP server updated to use Pi-hole (192.168.1.7) as DNS
- All network devices now get YouTube blocked via DNS
- Devices need to renew DHCP lease (reconnect WiFi) to get new DNS settings

**Configuration:**
- DNS Server: 192.168.1.7 (Pi-hole on Mac)
- Blocked Domains: youtube.com, youtu.be, googlevideo.com, ytimg.com, youtubei.googleapis.com
- DHCP configured on USG to push Pi-hole as DNS

### 2. WireGuard VPN Installation (2026-01-06)
**Status:** Installed and configured, awaiting server-side peer addition

**Package Installed:**
- Version: WireGuard v1.0.20210914
- Package: ugw3-v1-v1.0.20220627-v1.0.20210914.deb
- Source: https://github.com/WireGuard/wireguard-vyatta-ubnt/releases/download/1.0.20220627-1/

**Configuration:**
- Interface: wg0
- USG VPN IP: 192.168.2.3/32
- Listen Port: 51820
- Private Key: /config/auth/wg-private.key
- Public Key: NZG/IbateRIpY/Y2Nd6j7i0uF1HjoUy0X+aZujaxXiA=

**Peer Configuration:**
- Server: edenredux.servegame.com:51820 (174.54.51.209)
- Server Public Key: uEh1J4jgbAcqp6XYM9dZMxyFrxezBUZbAwNtX539zhc=
- Allowed IPs: 192.168.0.0/24, 192.168.2.0/24
- Keepalive: 25 seconds
- Status: Sending keepalive (296 B sent, 0 B received)

---

## ⏳ Pending Tasks

### 1. Add USG Peer to VPN Server
**Action Required:** The VPN server at edenredux.servegame.com needs the USG added as a peer.

**Configuration to Add:**
```ini
[Peer]
# USG 3P (192.168.1.1)
PublicKey = NZG/IbateRIpY/Y2Nd6j7i0uF1HjoUy0X+aZujaxXiA=
AllowedIPs = 192.168.2.3/32, 192.168.1.0/24
```

**Steps:**
1. SSH to the VPN server (edenredux.servegame.com)
2. Edit the WireGuard configuration file (usually /etc/wireguard/wg0.conf)
3. Add the peer configuration above
4. Restart WireGuard: `sudo systemctl restart wg-quick@wg0`

**Verification After Adding:**
```bash
# On USG, check if receiving data
sudo wg show

# Should now show bytes received > 0

# Test connectivity
ping 192.168.0.100
```

### 2. Test Access to Remote Services
Once the peer is added and VPN is fully connected:
- Test: http://192.168.0.100:5006
- Verify routing to entire 192.168.0.0/24 network

---

## Important Notes

### YouTube Blocking
- **WARNING:** DNS change on USG was made directly via SSH
- Configuration will be **overwritten** if USG is force-provisioned from UniFi controller
- To make persistent: Add DNS configuration to config.gateway.json on Cloud Key

### WireGuard Configuration
- **WARNING:** WireGuard configuration was made directly via SSH
- Configuration will be **overwritten** if USG is force-provisioned from UniFi controller
- To make persistent: Add WireGuard configuration to config.gateway.json on Cloud Key

### Recommendation
Create a comprehensive config.gateway.json file with both:
1. DNS server settings (Pi-hole)
2. WireGuard VPN configuration

This will allow proper force provision without losing custom configurations.

---

## Network Topology

```
Internet
   |
   └─ USG 3P (192.168.1.1)
       |
       ├─ LAN: 192.168.1.0/24
       |   ├─ Pi-hole/Mac: 192.168.1.7
       |   ├─ UniFi Cloud Key: 192.168.1.6
       |   └─ Windows PC: 192.168.1.9
       |
       └─ WireGuard VPN (wg0)
           ├─ USG VPN IP: 192.168.2.3/32
           └─ Remote Networks:
               ├─ 192.168.0.0/24 (via edenredux.servegame.com)
               └─ 192.168.2.0/24 (VPN network)
```

---

## Documentation Files

1. **wireguard-usg-installation-2026-01-06.md**
   - Complete WireGuard installation guide
   - Configuration details
   - Keys and peer information
   - Troubleshooting steps

2. **network-config-session-2026-01-05-evening.md**
   - Full session log (both sessions)
   - Pi-hole configuration
   - DHCP DNS changes
   - WireGuard installation timeline

3. **wireguard-windows-setup.md**
   - Windows PC WireGuard configuration (reference)
   - Same VPN server peer configuration

---

## Access Credentials

- **USG SSH:** mlWKaph@192.168.1.1 (QmJ7bDN6Ed2)
- **UniFi Controller:** https://192.168.1.6 (ericmilton711@gmail.com / PASSword!?1711)
- **Cloud Key SSH:** root@192.168.1.6 (PASSword!?1711)
- **Local Mac sudo:** mac user (645866)

---

## Next Steps (When You Return)

1. **Add USG peer to VPN server** (see pending tasks above)
2. **Verify VPN connectivity:**
   ```bash
   ssh mlWKaph@192.168.1.1
   sudo wg show    # Check if receiving data
   ping 192.168.0.100
   ```
3. **Test remote service access:** http://192.168.0.100:5006
4. **Optional:** Create config.gateway.json for persistent configuration

---

## Resources

- [WireGuard EdgeOS Wiki](https://github.com/WireGuard/wireguard-vyatta-ubnt/wiki/EdgeOS-and-Unifi-Gateway)
- [WireGuard Releases](https://github.com/WireGuard/wireguard-vyatta-ubnt/releases)
- [German Ubiquiti Forum - USG WireGuard](https://ubiquiti-networks-forum.de/wiki/entry/115-wireguard-installation-auf-dem-usg/)
- [HostiFi EdgeRouter WireGuard Guide](https://www.hostifi.com/blog/edgerouter-wireguard-remote-access-vpn)

---

## ⚠️ Final Step Blocked

### Issue
Cannot access VPN server (edenredux.servegame.com) to add USG peer:
- Server not accessible via SSH (only port 51820/WireGuard open)
- Mac's WireGuard connection not working (0 B received)
- Windows PC (which has working VPN) is offline

### Solutions

**EASIEST: Turn on Windows PC**
1. Turn on Windows PC at 192.168.1.9
2. It has working VPN to 192.168.0.x network
3. Can SSH to router at 192.168.0.1 and add USG peer
4. Detailed instructions in wireguard-usg-installation-2026-01-06.md

**Alternative: Fix Mac's VPN**
Mac has WireGuard configured but not receiving data - needs troubleshooting

**Alternative: Physical Access**
Access router at remote location directly

---

**Status:** WireGuard installed on USG, waiting for server-side peer addition
**Blocked By:** No access to VPN server to add peer configuration
**Generated:** 2026-01-06 14:32
**Work Completed:** WireGuard installation ✓, Configuration ✓, Server access ✗
